# RRSC_musicplayer
Open source music player for Rakusei Robot Study Club


# 概要
本プロジェクトは、洛星ロボット研究部の文化祭展示で使用することを目的として開発された音声ガイド端末です。
ハードウェアおよび組み込みソフトウェアの両方を自作しており、完全にオープンソースとして公開しています。

本システムは、SDカード、ディスプレイ、5つの物理ボタンを備えた構成になっています。
デフォルト機能として、SDカード上の wav ファイルを再生する音声ガイド機能を提供します。
一方で、用途を音声再生に限定せず、組み込みソフトウェアを変更することで機能を自由に拡張できる設計となっています。

## 主要部品

本音声ガイド端末は、以下の主要部品で構成されています。

* **STM32F103RCT6**
  メインプロセッサ。音声再生制御、ユーザー入力処理、周辺デバイス制御に使用。

* **SDカードスロット**
  音声データ（wavファイル）などの各種データを保存。

* **USB Type-C コネクタ**
  STM32 への書き込み（プログラム転送）および、内蔵 Li-Po バッテリーの充電の両方に使用。

* **イヤホンジャック**
  音声ガイドをイヤホンやヘッドホンで再生するための出力端子。

* **アンプ**
  STM32のアナログ音声データの増幅。

* **I2C ディスプレイ**
  動作状態や選択中の項目などを表示するために使用。

* **Li-Po バッテリー用安全回路／充電回路**
  過充電・過放電を防止し、安全にバッテリーを使用するための回路。

* **充電中に USB 給電へ切り替える回路**
  バッテリー充電中は USB からの給電に自動的に切り替わるよう設計されている。

* **ユーザー操作用スイッチ（5個）**
  再生操作やメニュー選択などのユーザーインタフェースとして使用。

# 既知の問題

本プロジェクトで使用している基板には、設計上の問題がいくつか存在します。
現状の基板を使用する場合、**そのままでは正常に動作しないため、物理的な修正が必要**です。

## STM32F103RCT6 の DAC / DMA 制約について

使用している STM32 マイコン（STM32F103RCT6）には DAC 出力が 2 系統存在します。
本設計では、これらを左右チャンネル（左耳・右耳）用として使用する想定でした。

しかし、DMA を使用可能なのは片方の DAC のみであることを考慮できておらず、
当初の設計のままでは、両チャンネルを同一方式で駆動することができませんでした。

## アンプ Enable ピンの未定義（フロート）状態

オーディオアンプの **Enable ピンがフロート状態**になっている設計ミスがありました。
動きません。

## 実施した対処

上記の問題に対し、以下のような**手作業による修正**を行いました。

* 近接するピンとのショート
* 不要なパターンのカット

これらの修正により、動作自体は可能となっていますが、
**再製作する場合は回路図および基板設計の修正を強く推奨**します。

